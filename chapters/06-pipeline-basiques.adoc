
[background-color="hsl(50, 89%, 74%)"]
= Pipeline: Basiques


== Exercise - Réutilisation Binaire

* But: réutiliser les binaires générés dans *Build*
* Action: "mise sur étagère": *Stash / Unstash*
* Modifier le Pipeline pour :
** "Stasher" le dossier `target`, à la fin de la phase *Build*
** "Unstasher" au début de la phase *Test*
* _Attention_, une limite de l'éditeur *Blue Ocean*
va être atteinte

== Solution - Réutilisation Binaire

* L'éditeur Blue Ocean ne supporte pas encore
le ré-ordonnancement de "stages"
** Mode textuel et/ou *Snippet Generator* à utiliser

[source,groovy,subs="attributes"]
----
include::{pipeline-solutions}/04-Jenkinsfile-stash-tests[]
----

== Post-Stage

* Section `post` :
** Contient des "steps" à exécuter
à la fin du Pipeline *ou* après une "stage"
** Divisé en "condition d'états":
`always`, `success`, `failure`, `changed`
* Chaque condition contient ses propres "steps"
* Pas _encore_ intégré dans l'éditeur Blue Ocean

== Exercice - Rapport de Tests Unitaires

* Si le "stage" *Build* échoue,
alors la tâche "archiveArtifacts" ne devrait pas être exécutée
** Même chose pour `stash`
* Les rapports de tests unitaires doivent être
publiés dans *tous* les cas après la phase *Build*
** Format Junit
** Stockés dans `target/{asterisk}{asterisk}/{asterisk}.xml`
* Utiliser la documentation:
** link:https://jenkins.io/doc/book/pipeline/syntax/#post[Post section on docs.jenkins.io]

== Solution - Rapport de Tests Unitaires

[source,groovy,subs="attributes"]
----
include::{pipeline-solutions}/05-Jenkinsfile-post-tests[]
----
